<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Management System</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        table th {
            text-align: center; 
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="text-center">Stock Management System</h1>

        <!-- Flash Message Block -->
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            <div class="mt-3">
              {% for category, message in messages %}
                <div class="alert alert-{{ category }}" role="alert">
                  {{ message }}
                </div>
              {% endfor %}
            </div>
          {% endif %}
        {% endwith %}

        <!-- File Upload Form to Upload Stock -->
        <h2>Manage Inventory</h2>
        <form action="{{ url_for('upload_inventory') }}" method="post" enctype="multipart/form-data">
            <div class="input-group mb-3">
                <input type="file" class="form-control" name="file" accept=".csv" required>
                <button class="btn btn-primary" type="submit">Upload Inventory</button>
            </div>
        </form>
        
        <!-- Button to Navigate to Orders Page -->
        <a href="{{ url_for('orders_page') }}" class="btn btn-secondary mb-3">Orders</a>
    <a href="{{ url_for('sales_predictions') }}" class="btn btn-info mb-3">Sales Predictions</a>

        <!-- Search Input -->
        <input type="text" id="searchInput" class="form-control mb-3" placeholder="Search...">

        <!-- Table Container for Inventory -->
        <div class="table-responsive" style="max-height: 500px; overflow-y: auto;">
            <table class="table table-bordered" id="productTable">
                <thead style="position: sticky; top: 0; background-color: #f8f9fa; z-index: 1;">
                    <tr>
                        <th style="text-align: center;" data-sort="id">Product ID</th>
                        <th style="text-align: center;" data-sort="name">Product Name</th>
                        <th style="text-align: center;" data-sort="price">Price</th>
                        <th style="text-align: center;" data-sort="stock">Stock Level</th>
                    </tr>
                </thead>
                <tbody>
                    {% for product in product_table %}
                    <tr class="{{ product.row_style }}">
                        <td>{{ product.product_id }}</td>
                        <td>{{ product.name }}</td>
                        <td>{{ product.price }}</td>
                        <td>{{ product.stock_level }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

    


        <!-- Add Product -->
        <h3 class="mt-4">Add Product</h3>
        <form action="{{ url_for('add_product') }}" method="post" class="mb-3">
            <div class="row g-3">
                <div class="col-md-4">
                    <input type="text" class="form-control" name="product_name" placeholder="Product Name" required>
                </div>
                <div class="col-md-3">
                    <input type="number" class="form-control" name="price" placeholder="Price" step="0.01" required>
                </div>
                <div class="col-md-3">
                    <input type="number" class="form-control" name="stock_level" placeholder="Stock Level" required>
                </div>
                <div class="col-md-2">
                    <button class="btn btn-primary" type="submit">Add Product</button>
                </div>
            </div>
        </form>
        

        <!-- Update Product -->
        <h3>Update Product</h3>
        <form action="{{ url_for('update_product') }}" method="post" class="mb-3">
            <div class="row g-3">
                <div class="col-md-2">
                    <input type="number" class="form-control" name="product_id" placeholder="Product ID" required>
                </div>
                <div class="col-md-4">
                    <input type="text" class="form-control" name="product_name" placeholder="Product Name" required>
                </div>
                <div class="col-md-3">
                    <input type="number" class="form-control" name="price" placeholder="Price" step="0.01" required>
                </div>
                <div class="col-md-3">
                    <input type="number" class="form-control" name="stock_level" placeholder="Stock Level" required>
                </div>
                <div class="col-md-2">
                    <button class="btn btn-warning" type="submit">Update Product</button>
                </div>
            </div>
        </form>

        <!-- Remove Product -->
        <h3>Remove Product</h3>
        <form action="{{ url_for('remove_product') }}" method="post" class="mb-3">
            <div class="row g-3">
                <div class="col-md-4">
                    <input type="number" class="form-control" name="product_id" placeholder="Product ID" required>
                </div>
                <div class="col-md-2">
                    <button class="btn btn-danger" type="submit">Remove Product</button>
                </div>
            </div>
        </form>
    </div>

    <!-- JavaScript for Search Functionality -->
    <script>
        $(document).ready(function () {
            // Attach search functionality
            $('#searchInput').on('input', function () {
                const searchValue = $(this).val().toLowerCase();
                // Find the table rows and filter based on the search input
                $('table tbody tr').filter(function () {
                    $(this).toggle($(this).text().toLowerCase().indexOf(searchValue) > -1);
                });
            });
        });

        // Sorting functionality
        $(document).ready(function () {
        // Add a click event to each column header
        $('#productTable thead th').on('click', function () {
            const column = $(this).data('sort'); // Get the column to sort by
            const rows = $('#productTable tbody tr').toArray(); // Get all rows in the table

            rows.sort((a, b) => {
                let valA, valB;

                // Determine the column values to compare
                if (column === 'id' || column === 'stock') {
                    // For numeric columns
                    valA = parseInt($(a).find('td:eq(' + getColumnIndex(column) + ')').text()) || 0;
                    valB = parseInt($(b).find('td:eq(' + getColumnIndex(column) + ')').text()) || 0;
                } else if (column === 'price') {
                    // For price column
                    valA = parseFloat($(a).find('td:eq(' + getColumnIndex(column) + ')').text()) || 0;
                    valB = parseFloat($(b).find('td:eq(' + getColumnIndex(column) + ')').text()) || 0;
                } else {
                    // For text columns
                    valA = $(a).find('td:eq(' + getColumnIndex(column) + ')').text().toLowerCase();
                    valB = $(b).find('td:eq(' + getColumnIndex(column) + ')').text().toLowerCase();
                }

                // Sort ascending
                if (valA < valB) return -1;
                if (valA > valB) return 1;
                return 0;
            });

            // Reattach sorted rows
            $('#productTable tbody').html(rows);
        });

        // Helper function to map column data-sort to column index
        function getColumnIndex(sortKey) {
            const columns = { id: 0, name: 1, price: 2, stock: 3 };
            return columns[sortKey];
        }
    });
    </script>
</body>
</html>
